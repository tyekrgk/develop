var masterAttention={attKey:"attentionList",attList:"",params:{},init:function(){this.params.userId=snsNotify.Util.Cookies.get("userid")},addParam:function(a){for(var b in a)this.params[b]=a[b]},main:function(){this.init();this.getMyAttention();this.listenAttention()},checkLogin:function(){return this.params.userId?!0:!1},listenAttention:function(){var a=this,b=null,c=0,f=!1,e="",d;$(".masterAtBox").on("click",function(){if(!a.checkLogin())return ThsLogin.showLoginBox("http://news.10jqka.com.cn/yaowen/redir.shtml"),
!1;$(this).hasClass("disabled")||(d=$(this).attr("data-master"),b=$("#atNum_"+d),"undefined"!=typeof b&&0<b.length&&(f=!0,c=parseInt(b.html())),$(this).hasClass("btn-jgz")?(e="add",a.addMyAttention(d,"add"),f&&b.html(c+1)):$(this).hasClass("btn-ygz")&&(e="cancel",a.addMyAttention(d,"cancel"),f&&(c=Math.max(c,1),b.html(c-1))),"function"==typeof attoverCallBack&&attoverCallBack(e,d),$(this).addClass("disabled"))})},sendRequest:function(a,b,c){$.ajax({url:a,type:"post",dataType:"jsonp",data:b,jsonpCallback:"atCallBack",
callBack:"atCallBack",success:function(a){c(a)}})},addAtt:function(a){this.attList[a]=a;window.storage.set(this.attKey,this.attList)},chkNull:function(a){if("undefined"==typeof a||"object"!=typeof a||!a)return!0;for(var b in a)return!1;return!0},delAtt:function(a){delete this.attList[a];if(this.chkNull(this.attList))this.attList={};window.storage.set(this.attKey,this.attList)},addMyAttention:function(a,b){var c=this,f=snsNotify.Util.Cookies.get("ticket");this.sendRequest("http://comment.10jqka.com.cn/api/masterAttention.php",
{reqType:b,masterId:a,token:f},function(e){0==e.errorCode&&(c.renderMaster(a,b),"add"==b?c.addAtt(a):c.delAtt(a))})},updateChk:function(){return window.storage?"homeindex"!=this.params.pageType&&"1"!=window.storage.get("updateFlag")?(window.storage.set("updateFlag",1),!0):!1:!0},restorageAtt:function(a){this.attList={};for(var b in a)"undefined"==typeof this.attList[a[b]]&&(this.attList[a[b]]=a[b]);window.storage.set(this.attKey,this.attList)},getMyAttention:function(){if(!this.checkLogin())return!1;
if(this.updateChk()){var a=this;this.sendRequest("http://comment.10jqka.com.cn/api/masterAttention.php",{reqType:"list"},function(b){if(0!=b.errorCode||!b.data||!b.data.masterIds)return!1;a.renderPage(b.data.masterIds);a.restorageAtt(b.data.masterIds)})}else{this.attList=window.storage.get(this.attKey);if(!this.attList)this.attList={};this.renderPage(this.attList)}return!0},renderPage:function(a){if("list"==this.params.pageType){if("undefined"!=typeof this.params.masterId){var b=this.params.masterId;
-1!=Object.keys(a).join(",").indexOf(b)&&this.renderMaster(b,"add")}}else{for(b in a)this.renderMaster(a[b],"add");"index"==this.params.pageType&&this.renderMyAttention(a)}},renderMaster:function(a,b){0<$("#masterAtBox-"+a).length&&("add"==b?($("#masterAtBox-"+a).removeClass("btn-jgz").addClass("btn-ygz"),$("#masterAtBox-"+a).html("取消关注")):"cancel"==b&&($("#masterAtBox-"+a).removeClass("btn-ygz").addClass("btn-jgz"),$("#masterAtBox-"+a).html("关注")))},renderMyAttention:function(a){this.params.userId&&
$(".J_wdgz").html("<div>我的关注</div>");if(0<a.length){var b="",c=0,f=[],e="",e=a.join(","),d;for(d in masterListJson)-1!=e.indexOf(masterListJson[d].id)&&(b+='<li><a href="http://master.10jqka.com.cn/mj_'+masterListJson[d].id+'/" target="_blank" title="'+masterListJson[d].name+'"><img src="'+masterListJson[d].logo+'" alt="avatar"><br><span>'+masterListJson[d].name.substr(0,4)+"</span></a></li>",f.push(masterListJson[d].id),c++);$(".J_wdgzlist").html(b);if(3>=c)for(e=b=a=0;9>e;e++)if(d=$(".headline-gz-hidden li").eq(a).attr("data-master-id"),
-1==$.inArray(d,f)){if($(".headline-gz-hidden li").eq(a).appendTo($(".headline-gz-list")),b++,9<=c+b)break}else a++}}};function loginbyjsonp(){var a=$("#username").val(),b=$("#password").val();"undefined"==typeof a||"undefined"==typeof b?$("#J_LoginBox").hide():$.getJSON("http://pass.10jqka.com.cn/login?act=loginByJsonp&username="+a+"&password="+b+"&inCharset=gbk&callback=?",function(a){0==a.errorcode?location.reload():alert("用户名或者密码错误，登录失败！")})};
masterAttention.renderMaster=function(a,b){0<$(".masterAtBox-"+a).length&&("add"==b?($(".masterAtBox-"+a).removeClass("btn-jgz").addClass("btn-ygz"),$(".masterAtBox-"+a).html("取消关注")):"cancel"==b&&($(".masterAtBox-"+a).removeClass("btn-ygz").addClass("btn-jgz"),$(".masterAtBox-"+a).html("关注")))};
var FK={args:{},checkArray:[],subArgs:[],init:function(a){this.setCheckArray();this.initArgs();if(a instanceof Object)for(key in a)this.args[key]=a[key];else alert("反馈传值有误")},initArgs:function(){this.args.content="";this.args.contact="";this.args.cate_id="";this.args.username="";this.args.code="";this.args.referer=document.location.href},setCheckArray:function(){this.checkArray=["content"]},check:function(){for(key in this.checkArray)if(!this.args[this.checkArray[key]])return!1;return!0},dataToString:function(a){var b=
"";if(a instanceof Object){for(key in a)b=b+key+"="+a[key]+"&";b=b.substr(0,b.length-1)}return b},submit:function(a){this.init(a);this.check()?$.ajax({url:"http://basic.10jqka.com.cn/vote/index.php?s=/Index/post",type:"POST",data:{content:this.args.content,contact:this.args.contact,cate_id:this.args.cate_id,username:this.args.username,code:this.args.code,referer:this.args.referer},dataType:"jsonp",callback:"_Callback",error:function(){alert("提交失败")},success:function(a){1==a.status?(alert("提交成功"),
TA.log({id:"master_index_fk"}),masterFunc.close()):alert(a.info)}}):alert("反馈内容不能为空！")}},masterFunc={main:function(){this.feedBack();this.collect();this.count()},feedBack:function(){$(".side-feedback").click(function(){$(".shade").css({display:"block",height:$(document).height()});$(".feedback-pop").fadeIn();document.documentElement.scrollTop=0});$(".close-btn").click(function(){masterFunc.close()});$(".answer-tc").focus(function(){this.value=""});$(".answer-tel").focus(function(){this.value=""});
$(".submit-btn").click(function(){var a=$(".answer-tel").val();if(/^\d{11}$/.test(a))return alert("请填写正确的邮箱地址"),!1;FK.submit({content:$(".answer-tc").val(),contact:a,cate_id:99,username:"",code:"",referer:document.location.href})})},collect:function(){$(".side-collect").click(function(){var a=document.location.href,b=document.title;try{window.external.addFavorite(a,b)}catch(c){try{window.sidebar.addPanel(b,a,"")}catch(d){alert("加入收藏失败，请使用Ctrl+D进行添加")}}})},close:function(){var a=$(".close-btn");$(a).parent().parent().hide();
$(a).parent().parent().prev(".shade").hide()},count:function(){$(".headline-tt a").bind("click",function(){TA.log({id:"master_index_top",_sid:"master_index_top"})});var a=snsNotify.Util.Cookies.get("userid");$(".J_wdgzlist a").bind("click",function(){a&&TA.log({id:"master_index_focus",sid:"master_index_focus"})});$(".J_news li").bind("click",function(){TA.log({id:"master_index_yytj",nj:1,_sid:"master_index_yytj"})});$(".rank-top li").bind("click",function(){TA.log({id:"master_index_hotmj",nj:1,_sid:"master_index_hotmj"})});
$(".side-feedback").bind("click",function(){"undefined"!=typeof masterAttention&&("list"==masterAttention.params.pageType?TA.log({id:"master_list_fk",_sid:"master_list_fk"}):"index"==masterAttention.params.pageType&&TA.log({id:"master_index_fk",_sid:"master_index_fk"}))});$(".side-collect,.art-collect").bind("click",function(){"undefined"!=typeof masterAttention&&("list"==masterAttention.params.pageType?TA.log({id:"master_list_sc",_sid:"master_list_sc"}):"index"==masterAttention.params.pageType&&
TA.log({id:"master_index_sc",_sid:"master_index_sc"}))});$(".side-share").bind("click",function(){"undefined"!=typeof masterAttention&&("list"==masterAttention.params.pageType?TA.log({id:"master_list_fx",_sid:"master_list_fx"}):"index"==masterAttention.params.pageType&&TA.log({id:"master_index_fx",_sid:"master_index_fx"}))});$(".sub-name a,.ml-jgz a").bind("click",function(){a&&TA.log({id:"master_index_gz",fid:"master_index_listmj"})})}};
